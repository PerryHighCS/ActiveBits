# Repo Discoveries

Durable implementation notes and discoveries for future contributors and agents.

## How To Use

1. Append new entries; do not rewrite history.
2. Keep entries concise and evidence-backed.
3. Link to paths/commands/tests that support each claim.

## Entry Template

| Date | Area | Discovery | Why It Matters | Evidence | Follow-up | Owner |
|---|---|---|---|---|---|---|
| YYYY-MM-DD | client/server/activities/tooling/docs | <what was learned> | <impact/risk/value> | <file path, command, or test> | <next action> | <name> |

## Entries

| Date | Area | Discovery | Why It Matters | Evidence | Follow-up | Owner |
|---|---|---|---|---|---|---|
| 2026-02-07 | tooling/docs | `.gitignore` had `.claude/*` ignored with only `plans` re-included; knowledge files would have been dropped from git without explicit unignore rules. | Prevents loss of durable repo knowledge and agent context. | `.gitignore` entries `!.claude/knowledge/` and `!.claude/knowledge/**` | Keep new durable `.claude/*` folders explicitly unignored when introduced. | codex |
| 2026-02-07 | docs/process | `AGENTS.md` is the long-lived operational contract; TypeScript migration docs are now treated as historical context. | Separates permanent agent workflow from temporary migration planning artifacts. | `AGENTS.md` sections `Read First`, `Historical Discoveries`, `Evidence and Tracking` | Keep `AGENTS.md` current as workflows evolve; archive one-off plans under `.claude/plans/`. | codex |
| 2026-02-07 | server/build | Backend migration policy is compile TypeScript to `server/dist` and run Node on emitted JS; backend bundler is not required. | Avoids bundler complexity with dynamic activity loading and keeps runtime Node-native. | `.claude/plans/typescript.md` Phase 3 runtime policy, `server/tsconfig.build.json` plan block | Re-evaluate bundling only for concrete deploy constraints (single-file artifact/serverless). | codex |
| 2026-02-07 | client/server/deploy | Production source maps are intentionally public for this open-source repo (`client` and `server`). | Improves debugging and contributor transparency; must be reflected in deployment docs. | `.claude/plans/typescript.md` source map policy sections, `DEPLOYMENT.md` “Source Map Policy (Open-Source Repo)” | Verify `.map` artifacts in build/deploy checks (`client/dist`, `server/dist`). | codex |
| 2026-02-07 | activities/process | Activity migration batching rule is one activity directory per PR. | Reduces blast radius and simplifies rollback/review during high-volume migrations. | `.claude/plans/typescript.md` section `5.3 Activity batching policy (one activity per PR)` | Enforce in review template/checklist for Phase 5 PRs. | codex |
| 2026-02-07 | server/tests/tooling | In Codex sandbox, server tests and `verify:server` can fail with `EPERM` on socket bind even when local runs pass. | Prevents misclassifying environment limitations as repo regressions; requires explicit manual verification note. | `npm --workspace server test`, `npm run verify:server`, error `listen EPERM ... 0.0.0.0:4010`; user-confirmed local pass. | Treat local/CI as canonical for server bind-dependent checks; record manual verification in review logs. | codex |
| 2026-02-07 | client/tooling | Client `tsc --noEmit` can fail on `vite.config.ts` when root and client use different Vite majors, due plugin type mismatches. | Helps avoid false-negative typecheck failures during migration; informs tooling harmonization priority. | `npm run typecheck --workspaces --if-present`, error on `client/vite.config.ts` plugin types between root `vite@7` and client `vite@6`. | Harmonize Vite versions or isolate config typing strategy before strict config typecheck enforcement. | codex |
| 2026-02-07 | client/tooling | Vite type mismatch issue resolved by aligning root/client to Vite `7.3.1` and compatible plugin versions. | Confirms single-version toolchain removes cross-package type identity errors in `vite.config.ts` typecheck. | User-reported `npm ls vite` alignment + passing `npm run typecheck --workspaces --if-present` and `npm --workspace client run build`. | Keep root/client Vite and plugin versions in lockstep to prevent regression. | codex |
| 2026-02-07 | client/linting | Flat-config ESLint emits warning for `/* eslint-env node */` comment in `client/vite.config.ts`; this becomes an error target in ESLint v10. | Avoids future CI breaks on ESLint major upgrade. | `npm --workspace client test` warning output referencing `/client/vite.config.ts` line 1. | Replace with flat-config-compatible globals declaration or remove comment and rely on config-scoped globals. | codex |
| 2026-02-07 | client/linting | Removed legacy `/* eslint-env node */` from `client/vite.config.ts`; client lint now runs clean under current flat config. | Closes the previously recorded ESLint v10 migration warning path. | `npm --workspace client test` after removal (no ESLintEnvWarning). | Keep globals declared in flat config (not file comments) for future config files. | codex |
| 2026-02-07 | client/server/activities/migration | Mixed-extension activity loading now supports config and entry overlap windows (`activity.config.{js,ts}`, client `index.{js,jsx,ts,tsx}`, server `serverEntry` `.js`/`.ts` fallback). | Prevents loader/registry regressions while activities migrate one-by-one from JS to TS. | `client/src/activities/index.js`, `server/activities/activityRegistry.js`, `node --import tsx --test server/activities/activityRegistry.test.js` pass. | Keep extension-priority behavior stable (`.ts`/`.tsx` preferred) until final JS cleanup phase. | codex |
| 2026-02-07 | server/tests | `activityRegistry` compatibility tests can emit expected route-registration errors while still passing, because they intentionally use minimal `app/ws` stubs and intentionally broken temp configs in specific cases. | Prevents false-positive debugging churn when contributors see `TypeError`/`[ERROR]` lines in otherwise passing test runs. | User-local `npm --workspace server test` output: `35` pass, `0` fail, with expected logs from `registerActivityRoutes` and broken-config tests. | Consider tightening stubs in future to reduce log noise if it becomes a CI readability issue. | codex |
| 2026-02-07 | server/migration | During early Phase 3, converting core modules to `.ts` without keeping JS runtime compatibility breaks `verify:server` while `server/server.js` is still the plain-Node fallback entrypoint. | Prevents premature runtime regressions; backend module renames need either a TS entrypoint/runtime switch or temporary JS compatibility files until that switch lands. | `npm run verify:server` failure `Cannot find module .../server/core/sessionNormalization.js`, then pass after restoring JS compatibility files and running `npm run verify:server` outside sandbox. | In the next Phase 3 slice, migrate `server/server.js` to `server.ts` and update runtime fallback strategy so JS compatibility duplicates can be removed safely. | codex |
| 2026-02-07 | server/tooling | In this NodeNext + strict TS setup, `ioredis` default import in `.ts` required an explicit constructor/client interface cast to keep the Redis constructor and client methods type-safe without disabling strict checks. | Prevents migration stalls caused by `Cannot use namespace 'Redis' as a type` / non-constructable default import errors during backend TS conversion. | `server/core/valkeyStore.ts` typed `RedisConstructor`/`RedisClient` shim; `npm --workspace server run typecheck` pass after patch. | Revisit and simplify typings if upstream `ioredis` ESM typings are adjusted or project module interop changes. | codex |
| 2026-02-07 | server/types | Cross-module session interfaces in TS need to be shared from a single source (`sessions.ts`) instead of re-declared per file, or strict mode treats same-named shapes as incompatible in function signatures. | Avoids opaque “Two different types with this name exist, but they are unrelated” failures during incremental backend conversion. | `server/core/persistentSessionWs.ts` initial typecheck failure against `createSession`; fixed by exporting `SessionRecord`/`SessionStore` from `server/core/sessions.ts` and importing those types. | Continue exporting canonical backend contracts from core modules as additional files migrate to TS. | codex |
| 2026-02-07 | server/migration | Phase 3 route/registry transitional conversion works by adding TS counterparts (`statusRoute.ts`, `persistentSessionRoutes.ts`, `activityRegistry.ts`) while retaining existing JS runtime files. | Enables strict type progress on backend internals without forcing immediate runtime entrypoint cutover. | `npm --workspace server run typecheck` pass; `node --import tsx --test server/phase3RoutesRegistryTs.test.ts`; `npm --workspace server test` pass (`38`/`0`). | Next Phase 3 slice: migrate `server/server.js` to `server.ts` and move runtime to compiled `dist/server.js` as default. | codex |
| 2026-02-07 | server/test-runtime | In server tests run with `tsx`, importing `.js` specifiers can execute colocated `.ts` counterparts when present. | Provides immediate behavioral coverage for migrated TS modules before production runtime switches to compiled TS output. | `npm --workspace server test` stack traces show `server/activities/activityRegistry.ts` invoked by `server/activities/activityRegistry.test.js`. | Keep this behavior in mind when interpreting test coverage and regressions during mixed-extension phases. | codex |
| 2026-02-07 | server/entrypoint | Adding `server/server.ts` enables `tsc -p server/tsconfig.build.json` to emit `server/dist/server.js`, while the `start` script can still safely fall back to `server.js` when dist is absent. | Moves Phase 3 closer to compiled runtime default without breaking existing fallback-based workflows. | `server/server.ts`; `npm --workspace server run typecheck`; `npm --workspace server test`; `npm run verify:server`; `DEPLOYMENT.md` transitional runtime section updated. | In next cleanup slice, remove JS fallback entrypoint once `scripts/verify-server.js` and deployment flow are fully dist-first. | codex |
| 2026-02-07 | server/scripts | Valkey utility scripts can be migrated incrementally by adding `.ts` counterparts and making npm scripts prefer TS with JS fallback. | Keeps operational tooling usable during migration while advancing strict typing coverage. | `server/test-valkey.ts`, `server/monitor-valkey.ts`, `server/package.json` script updates, `npm test` pass. | Remove JS script fallbacks after remaining backend test/script migration work is complete. | codex |
| 2026-02-07 | server/tests | Backend test migration can proceed file-by-file by renaming individual `*.test.js` files to `*.test.ts` without changing discovery command semantics. | Reduces migration risk and keeps regression signal clear while preserving full-suite coverage. | `server/broadcastUtils.test.ts` replacing `server/broadcastUtils.test.js`; `npm --workspace server test` pass (`38`/`0`). | Continue converting remaining server tests (`statusRoute`, `sessionStore`, `galleryWalkRoutes`, `persistentSessionRoutes`, `activityRegistry`) in small slices. | codex |
| 2026-02-07 | server/tests | Phase 3 backend test migration is now complete: server test suite runs entirely from `.test.ts` files with strict typing fixes for `fetch().json()` and dynamic import helpers. | Closes the remaining backend JS test surface and reduces risk before Phase 4 frontend migration. | `rg --files server -g "*.test.js"` (no results), new TS files under `server/`, `npm --workspace server run typecheck`, `npm --workspace server test`, `npm test` all pass. | In cleanup phase, simplify server test discovery command to TS-only patterns after final JS removal policy is enacted. | codex |
| 2026-02-07 | server/runtime | After backend TS entrypoint and tests stabilized, legacy backend `.js` source fallbacks were safely removable; start/verify flows now run compiled `dist/server.js` or TS fallback (`node --import tsx server.ts`). | Eliminates duplicate backend code paths and drift risk while preserving local/runbook usability without requiring a prebuilt `dist` directory. | `server/package.json` start/dev/script updates, `scripts/verify-server.js` fallback logic, deletion of `server/server.js` and migrated `server/core|routes|activities/*.js` files, `npm test` pass. | During Phase 7, tighten test discovery to TS-only patterns and revisit whether TS runtime fallback should remain or become compile-required for all starts. | codex |
| 2026-02-07 | client/tests | Client workspace TS config currently sets `types` to `vite/client`, so Node runner tests converted to `.ts` need explicit Node type strategy; keeping new utility test as `.js` avoided introducing unrelated config churn in Phase 4 kickoff. | Prevents frontend migration stalls from `node:test` typing errors and keeps slice scope focused on utility conversion. | `client/tsconfig.json` (`types: ["vite/client"]`), `client/src/utils/csvUtils.ts` conversion with `client/src/utils/csvUtils.test.js`, `npm --workspace client test` pass. | Decide Phase 4 test-typing approach (per-file `/// <reference types="node" />` vs. dedicated test tsconfig) before bulk `.test.ts` migration. | codex |
| 2026-02-07 | server/types | `server/core/wsRouter.ts` had duplicate websocket interfaces that could drift from shared contracts; importing from `types/websocket.ts` and extending canonical types with `WsConnectionHandler` + `wss.close()` keeps server shutdown/router typing aligned. | Reduces maintenance risk from parallel interface edits and makes websocket contract changes propagate from one source. | `server/core/wsRouter.ts` type-only import from `../../types/websocket.js`, `types/websocket.ts` updates, `npm --workspace server run typecheck`, `npm --workspace server test`. | Reuse `types/websocket.ts` in additional websocket-related modules when practical to further reduce local ad-hoc interface copies. | codex |
| 2026-02-07 | server/types | `app.locals.sessions` no longer needs an unsafe `as unknown as never` cast after aligning shared session-store typing with the real server store contract. | Restores type-safety at bootstrap and reduces risk of silently hiding contract mismatches between Express locals and session store implementations. | `server/server.ts` direct assignment, `types/session.ts` contract updates, `server/core/sessions.ts` now extends shared `SessionStore`, `npm run typecheck --workspaces --if-present`, `npm --workspace server test`. | Keep shared `types/session.ts` and `server/core/sessions.ts` in lockstep when adding store features (pub/sub/cache hooks, method return types). | codex |
| 2026-02-07 | client/types | Migrating `client/src/activities/index.js` to TS required a canonical renderable component type because `React.lazy(...)` values are not plain `ComponentType`; `ActivityRegistryEntry` now models lazy-loaded components explicitly. | Prevents false type errors and contract drift in the activity registry while preserving lazy-loading behavior during mixed JS/TS migration. | `client/src/activities/index.ts`, `types/activity.ts`, `npm run typecheck --workspaces --if-present`, `npm test`. | Reuse `ActivityRenderableComponent` for future frontend component registries instead of re-declaring ad-hoc lazy/component unions. | codex |
| 2026-02-07 | client/hooks | Converting `useClipboard` to TS is straightforward when core clipboard/timer logic is extracted into a typed helper (`copyTextWithReset`) and tested directly under Node runner. | Keeps hook migration incremental without introducing new browser-test dependencies while still adding behavior-focused regression coverage. | `client/src/hooks/useClipboard.ts`, `client/src/hooks/useClipboard.test.ts`, `npm --workspace client test`, `npm test`. | Apply the same pattern to other hook migrations (`useSessionEndedHandler`, `useResilientWebSocket`) when direct React hook rendering tests are not yet available in client tooling. | codex |
| 2026-02-07 | client/hooks | `useSessionEndedHandler` TS migration stays low-risk when websocket message parsing is split into a pure helper (`isSessionEndedMessageData`) and hook logic keeps listener attach/cleanup unchanged. | Improves type safety for WebSocket event handling while keeping redirect behavior and cleanup semantics stable during incremental frontend migration. | `client/src/hooks/useSessionEndedHandler.ts`, `client/src/hooks/useSessionEndedHandler.test.ts`, `npm --workspace client test`, `npm run typecheck --workspaces --if-present`. | Use the same “pure parser + typed hook shell” approach for `useResilientWebSocket` message/reconnect handling. | codex |
| 2026-02-07 | client/hooks | `useResilientWebSocket` migration is easier to verify by extracting small pure helpers (`resolveWebSocketUrl`, `getReconnectDelay`) and keeping connect/reconnect side effects in the hook shell. | Enables reliable Node-based tests for reconnect policy while preserving existing runtime websocket behavior in React components. | `client/src/hooks/useResilientWebSocket.ts`, `client/src/hooks/useResilientWebSocket.test.ts`, `npm --workspace client test`, `npm run typecheck --workspaces --if-present`, `npm --workspace client run build`. | Continue this pattern for upcoming TSX component migrations: extract pure formatting/decision helpers where possible and test them directly. | codex |
| 2026-02-07 | client/ui | Migrating shared UI components to TSX is smoother when style/logic helpers are moved out of component files that are subject to `react-refresh/only-export-components`. | Keeps lint clean during TSX migration while retaining testable pure helper functions and stable component behavior. | `client/src/components/ui/Button.tsx`, `client/src/components/ui/buttonStyles.ts`, `client/src/components/ui/Modal.tsx`, `client/src/components/ui/RosterPill.tsx`, `npm --workspace client test`, `npm run typecheck --workspaces --if-present`, `npm --workspace client run build`. | Apply the same split pattern when migrating additional shared components that need exported utility functions. | codex |
| 2026-02-07 | client/common | For router-dependent components like `SessionEnded`, rendering under `MemoryRouter` provides lightweight regression coverage in Node tests without introducing browser test tooling. | Keeps migration momentum while validating key UI copy/structure around navigation-dependent hooks (`useNavigate`). | `client/src/components/common/SessionEnded.tsx`, `client/src/components/common/SessionEnded.test.tsx`, `client/src/components/common/LoadingFallback.tsx`, `client/src/components/common/LoadingFallback.test.tsx`, `npm --workspace client test`. | Reuse this pattern for additional route-aware component migrations until dedicated DOM test tooling is introduced. | codex |
| 2026-02-07 | client/common | Browser/hardware-bound UI (QR scanning) can still be migration-tested by extracting deterministic error-mapping utilities and validating those helpers directly in Node tests. | Preserves TypeScript migration velocity and regression coverage when components depend on camera/scanner hooks that are not practical in the current test runtime. | `client/src/components/common/QrScannerPanel.tsx`, `client/src/components/common/qrScannerUtils.ts`, `client/src/components/common/qrScannerUtils.test.ts`, `npm --workspace client test`, `npm run typecheck --workspaces --if-present`. | Continue extracting pure parser/mapping helpers for remaining complex common components during TSX migration. | codex |
| 2026-02-07 | client/common | Route-aware manager headers that read `window.location` should guard for non-browser runtimes during migration, so static-render tests and SSR-like environments do not crash. | Allows safe TSX conversion and test coverage for navigation components without changing browser behavior. | `client/src/components/common/SessionHeader.tsx` (`typeof window !== 'undefined'` guard), `client/src/components/common/SessionHeader.test.tsx`, `npm --workspace client test`. | Apply the same runtime guard pattern where remaining components derive URLs from `window` directly. | codex |
| 2026-02-07 | client/common | For websocket-driven waiting-room UIs, strict TS is easier to maintain when inbound websocket payloads are parsed into a raw envelope and then narrowed with explicit message-shape guards before branching. | Prevents unsafe property access and keeps reconnect/auth navigation flows type-safe without changing runtime behavior. | `client/src/components/common/WaitingRoom.tsx`, `client/src/components/common/waitingRoomUtils.ts`, `client/src/components/common/waitingRoomUtils.test.ts`, `npm --workspace client test`, `npm run typecheck --workspaces --if-present`. | Reuse raw-parse + type-guard message handling for remaining websocket-heavy components (e.g., `SessionRouter`) during TSX migration. | codex |
| 2026-02-07 | client/common | `StatusDashboard` TSX migration is safest when the API-shaping/formatting/sorting logic is extracted into pure typed helpers and tested separately from the polling UI shell. | Keeps strict typing aligned to `/api/status` while preserving behavior and adding deterministic coverage without browser-only test tooling. | `client/src/components/common/StatusDashboard.tsx`, `client/src/components/common/statusDashboardUtils.ts`, `client/src/components/common/statusDashboardUtils.test.ts`, `npm --workspace client test`, `npm run typecheck --workspaces --if-present`. | Reuse the same "typed payload + extracted pure helpers" pattern for remaining large JSX components (`ManageDashboard`, `SessionRouter`). | codex |
| 2026-02-07 | client/common | `ManageDashboard` TSX migration is more stable when activity `deepLinkOptions` are normalized through typed helper functions rather than read directly from `unknown` config objects in JSX. | Avoids repeated ad-hoc casts during render paths and keeps persistent/solo link generation behavior testable under strict TypeScript. | `client/src/components/common/ManageDashboard.tsx`, `client/src/components/common/manageDashboardUtils.ts`, `client/src/components/common/manageDashboardUtils.test.ts`, `npm --workspace client test`, `npm run typecheck --workspaces --if-present`. | Reuse `manageDashboardUtils` parsing/normalization helpers when `SessionRouter` migrates, since it also consumes activity config and deep-link query behavior. | codex |
| 2026-02-07 | client/common | `SessionRouter` TSX migration is easier to stabilize by isolating localStorage cache cleanup and persistent-query serialization into pure helpers before typing route-branch rendering logic. | Reduces type noise in a large multi-flow component and makes cache/query behavior regression-testable without rendering-heavy route tests. | `client/src/components/common/SessionRouter.tsx`, `client/src/components/common/sessionRouterUtils.ts`, `client/src/components/common/sessionRouterUtils.test.ts`, `npm --workspace client test`, `npm run typecheck --workspaces --if-present`. | Reuse this extraction-first approach when converting `App.jsx` and `main.jsx` to keep route shell typing changes reviewable. | codex |
| 2026-02-07 | client/entrypoints | Converting `App`/`main` to TSX is low-risk when route/footer decision logic is extracted into a small pure helper and tested independently (`findFooterActivity`). | Keeps entrypoint migration reviewable while preserving dynamic activity route generation and lazy footer behavior. | `client/src/App.tsx`, `client/src/main.tsx`, `client/src/appUtils.ts`, `client/src/appUtils.test.ts`, `npm --workspace client test`, `npm run typecheck --workspaces --if-present`. | Apply the same “extract + test pure routing helper” pattern if additional route-shell refactors are needed during Phase 4/5. | codex |
| 2026-02-07 | client/tests | After converting `index.test` and `csvUtils.test` to TS, `client/src` has no remaining `.js/.jsx` files; all client tests now run from `.test.ts/.test.tsx`. | Closes the remaining client JS test surface and removes a blocker for later `allowJs: false` cleanup in Phase 7. | `rg --files client/src -g '*.js' -g '*.jsx'` (no results), `client/src/activities/index.test.ts`, `client/src/utils/csvUtils.test.ts`, `npm --workspace client test`, `npm run typecheck --workspaces --if-present`. | In cleanup phase, simplify client test discovery command to TS-only patterns once cross-workspace JS test compatibility is no longer needed. | codex |
| 2026-02-07 | activities/tooling | TypeScript activity conversions that import shared client modules via `@src/*` require an `@src/*` path mapping in `activities/tsconfig.json`; otherwise activities typecheck fails even though runtime bundling works in client builds. | Prevents repeated TS migration friction when converting activity client code that already uses shared hooks/components from `client/src`. | `activities/tsconfig.json` paths update (`@src/*` -> `../client/src/*`), `npm run typecheck --workspaces --if-present` pass after change. | Keep `activities` TS path mappings aligned with client alias usage during Phase 5, and revisit alias cleanup rules in Phase 7. | codex |
| 2026-02-07 | activities/raffle | Full raffle activity migration to TS works as a single vertical slice when winner-selection logic is extracted into a pure helper (`raffleUtils.ts`) with deterministic tests. | Keeps one-activity-per-slice policy while adding concrete regression coverage for raffle draw rules and minimizing behavior drift during JSX/JS -> TSX/TS conversion. | `activities/raffle/*` TS files, `activities/raffle/client/manager/raffleUtils.test.ts`, `npm --workspace activities test`, `npm --workspace client run build`. | Apply the same extract-and-test approach for upcoming activity slices (`www-sim`, `java-string-practice`) where route/client files are larger. | codex |
| 2026-02-07 | activities/client-types | Activity client entry modules converted to TSX often need explicit `ComponentType<unknown>` casts for manager/student exports to satisfy the shared `ActivityClientModule` contract during mixed-prop migration. | Avoids false-negative type errors when activity student/manager components still use activity-specific prop contracts while the registry expects `unknown` props. | `activities/www-sim/client/index.tsx`, `activities/raffle/client/index.tsx`, `npm run typecheck --workspaces --if-present`. | As more activities migrate, replace cast-heavy exports by tightening shared activity component prop contracts where feasible. | codex |
| 2026-02-07 | activities/www-sim | `www-sim` migration stability improved by creating one activity-local shared type module (`wwwSimTypes.ts`) consumed by both client and server TS files, plus extracted pure route helpers with direct tests. | Reduces payload/session shape drift across manager/student/routes and keeps complex route behavior testable without spinning up route integration harnesses for every logic change. | `activities/www-sim/wwwSimTypes.ts`, `activities/www-sim/server/routeUtils.ts`, `activities/www-sim/server/routeUtils.test.ts`, `npm --workspace activities test`, `npm test`. | Reuse the same per-activity "shared types + extracted pure helpers" pattern for larger upcoming activity migrations. | codex |
| 2026-02-07 | activities/java-string-practice | Java String Practice migration required a shared activity type module plus separate server validation helpers to keep challenge/session/websocket contracts consistent under strict TS without changing classroom runtime behavior. | Prevents drift between manager/student/server message/session shapes and makes high-churn validation logic (`studentName`, `stats`, `methods`) directly testable outside route handlers. | `activities/java-string-practice/javaStringPracticeTypes.ts`, `activities/java-string-practice/server/routeUtils.ts`, `activities/java-string-practice/server/routeUtils.test.ts`, `activities/java-string-practice/client/components/challengeLogic.test.ts`, `npm test`. | Apply this same split (shared activity types + route helper unit tests) to remaining larger activity migrations (`gallery-walk`, `traveling-salesman`, `python-list-practice`). | codex |
| 2026-02-07 | client/common | Join-session validation should not rely on `parseInt(..., 16)` because it accepts trailing non-hex characters; use full-string hex validation plus explicit all-zero rejection. | Prevents malformed join IDs from being treated as valid and keeps route branching consistent for manager/student join flows. | `client/src/components/common/sessionRouterUtils.ts` (`isJoinSessionId`), `client/src/components/common/sessionRouterUtils.test.ts`, `npm --workspace client test`. | Keep future join-id parsing changes aligned with this strict contract (`^[a-f0-9]+$`, not all zeros). | codex |
| 2026-02-07 | client/common | Status-session sorting must normalize invalid `Date.parse` results (`NaN`) before comparing timestamps in dashboard rows. | Prevents non-deterministic ordering when malformed `lastActivity` strings appear in status payloads. | `client/src/components/common/statusDashboardUtils.ts` (`parseTimestamp`), `client/src/components/common/statusDashboardUtils.test.ts`, `npm --workspace client test`. | Keep timestamp parse helpers returning finite numbers (`0` fallback) wherever comparator math is used. | codex |
| 2026-02-07 | activities/algorithm-demo | `algorithm-demo` kickoff migration can convert config, client entry, and shared utility/registry modules to TS while leaving large manager/student/algorithm JSX files on JS for a later completion slice. | Keeps one-activity migration progress moving with low risk and preserves behavior by limiting strict-typing work to modules that already have focused tests. | `activities/algorithm-demo/activity.config.ts`, `activities/algorithm-demo/client/index.tsx`, `activities/algorithm-demo/client/utils.ts`, `activities/algorithm-demo/client/algorithms/index.ts`, `npm --workspace activities run typecheck`, `npm --workspace activities test`. | Finish `algorithm-demo` completion slice by migrating manager/student views, remaining algorithm JSX modules, and `server/routes.js` to TS. | codex |
| 2026-02-07 | activities/algorithm-demo | Shared UI/util modules in algorithm-demo (`AlgorithmPicker`, `PseudocodeRenderer`, `pseudocodeUtils`) migrate cleanly to TS when highlight/overlay contracts are typed and legacy `highlightedIds` compatibility is preserved. | Reduces migration risk in large visualizer components by first typing shared rendering surfaces with targeted tests before converting manager/student/algorithm files. | `activities/algorithm-demo/client/components/*.tsx`, `activities/algorithm-demo/client/utils/pseudocodeUtils.tsx`, tests under `activities/algorithm-demo/client/components/*.test.tsx` and `activities/algorithm-demo/client/utils/pseudocodeUtils.test.tsx`, `npm --workspace activities test`. | Reuse this "convert shared render helpers first" approach while migrating the remaining algorithm visualizer files and manager/student shells. | codex |
| 2026-02-07 | activities/algorithm-demo | Converting `server/routes.js` to `routes.ts` with strict-typed request/session helpers requires test mocks that structurally match Express/WebSocket handler signatures (`Request`/`Response`, socket `readyState` + `send`) to keep activities typecheck green. | Prevents migration regressions where tests pass at runtime but fail compile-time under strict function type checks. | `activities/algorithm-demo/server/routes.ts`, `activities/algorithm-demo/server/routes.test.ts`, `activities/algorithm-demo/activity.config.ts`, `npm --workspace activities run typecheck`, `npm test`. | Continue algorithm-demo completion slice by migrating remaining manager/student/algorithm JSX modules. | codex |
| 2026-02-07 | activities/algorithm-demo | Manager/student shell migration to TSX is more reliable when websocket payload parsing is isolated into typed helpers and cross-workspace imports use explicit relative paths instead of `@src/*` aliases in activities tests. | Avoids `unknown` state/component call errors under strict TS and prevents module-resolution failures in activities workspace test runs. | `activities/algorithm-demo/client/manager/DemoManager.tsx`, `activities/algorithm-demo/client/student/DemoStudent.tsx`, `activities/algorithm-demo/client/manager/DemoManager.test.tsx`, `activities/algorithm-demo/client/student/DemoStudent.test.tsx`, `npm --workspace activities test`, `npm test`. | Finish algorithm-demo by converting remaining algorithm visualizer `.jsx` modules to `.tsx`. | codex |
| 2026-02-07 | activities/algorithm-demo | Search visualizer modules (`LinearSearch`, `BinarySearch`) can be migrated to TSX incrementally by keeping module behavior intact and adding small, direct module-state tests (`initState`, `reduceEvent`) instead of full UI harness tests. | Preserves migration momentum on large visualizer files while still adding concrete regression coverage for step progression and state-reset behavior. | `activities/algorithm-demo/client/algorithms/search/LinearSearch.tsx`, `activities/algorithm-demo/client/algorithms/search/BinarySearch.tsx`, `activities/algorithm-demo/client/algorithms/search/LinearSearch.test.ts`, `activities/algorithm-demo/client/algorithms/search/BinarySearch.test.ts`, `npm --workspace activities run typecheck`, `npm --workspace activities test`. | Apply the same typed-state + direct module tests pattern to remaining sorting/recursion/guessing visualizer modules. | codex |
| 2026-02-08 | activities/algorithm-demo | Recursion/guessing visualizers and selection sort can be migrated safely by typing module state/view contracts and adding lightweight `initState`/`reduceEvent` tests for logic-heavy modules. | Keeps strict TypeScript progress moving on large algorithm files while preserving interactive behavior and avoiding heavy UI harness overhead. | `activities/algorithm-demo/client/algorithms/recursion/Factorial.tsx`, `activities/algorithm-demo/client/algorithms/recursion/Fibonacci.tsx`, `activities/algorithm-demo/client/algorithms/guessing/BinarySearchGame.tsx`, `activities/algorithm-demo/client/algorithms/sorting/SelectionSort.tsx`, corresponding `*.test.ts`, `npm --workspace activities run typecheck`, `npm test`. | Continue with remaining sorting visualizers (`InsertionSort`, `MergeSort`) using the same module-state test pattern. | codex |
| 2026-02-08 | activities/algorithm-demo | For large visualizer files, migration can stay incremental by converting one sorting module (`InsertionSort`) to TSX while adding direct module-state tests to both converted and not-yet-converted modules (`MergeSort`). | Preserves migration momentum and regression coverage without forcing an oversized strict-typing change in a single slice. | `activities/algorithm-demo/client/algorithms/sorting/InsertionSort.tsx`, `activities/algorithm-demo/client/algorithms/sorting/InsertionSort.test.ts`, `activities/algorithm-demo/client/algorithms/sorting/MergeSort.test.ts`, `npm --workspace activities run typecheck`, `npm test`. | Convert `MergeSort.jsx` to `MergeSort.tsx` in a dedicated follow-up slice with focused strict-typing cleanup. | codex |
| 2026-02-08 | activities/algorithm-demo | `MergeSort` can be migrated without rewriting its core step machine by typing the module boundaries first (props/events/refs/map callbacks) and using explicit CSS variable casts where animation styles rely on custom properties. | Reduces risk for very large visualizer modules by keeping algorithm logic intact while satisfying strict TS incrementally. | `activities/algorithm-demo/client/algorithms/sorting/MergeSort.tsx`, `activities/algorithm-demo/client/algorithms/index.ts`, `npm --workspace activities run typecheck`, `npm test`. | Apply the same boundary-first typing strategy for remaining large activity modules outside algorithm-demo. | codex |
| 2026-02-08 | client/common | Persistent-session client URL construction should use dedicated helpers (`URLSearchParams` + `encodeURIComponent` for path segments) instead of raw string interpolation in route/waiting-room fetches. | Prevents malformed requests when `hash` or `activityName` contain reserved characters and keeps query behavior consistent across websocket and REST calls. | `client/src/components/common/WaitingRoom.tsx`, `client/src/components/common/SessionRouter.tsx`, `client/src/components/common/waitingRoomUtils.ts`, `client/src/components/common/sessionRouterUtils.ts`, `npm --workspace client test`. | Reuse URL-builder helpers for any future persistent-session endpoints to avoid regressions from ad-hoc query concatenation. | codex |
| 2026-02-08 | activities/java-format-practice | A low-risk kickoff for large activity directories is converting `activity.config` and `client/index` to TS first, plus a module-shape test, before touching route/component internals. | Keeps one-activity migration slices reviewable while validating loader/registry contracts early. | `activities/java-format-practice/activity.config.ts`, `activities/java-format-practice/client/index.ts`, `activities/java-format-practice/client/index.test.ts`, `npm --workspace activities test`, `npm run typecheck --workspaces --if-present`. | Complete Java Format Practice by migrating `server/routes.js`, client manager/student/components, and utility modules to TS/TSX. | codex |
| 2026-02-08 | activities/java-format-practice | Server route migration is safer when validator logic is extracted into `routeUtils.ts` with direct tests, and session payloads are normalized via `registerSessionNormalizer` in the typed route module. | Reduces strict-typing churn in websocket-heavy routes and protects behavior when reconnecting students from partially shaped session data. | `activities/java-format-practice/server/routes.ts`, `activities/java-format-practice/server/routeUtils.ts`, `activities/java-format-practice/server/routeUtils.test.ts`, `activities/java-format-practice/javaFormatPracticeTypes.ts`, `npm --workspace activities test`, `npm run typecheck --workspaces --if-present`. | Continue Java Format Practice completion by migrating client manager/student/components/utils to TS/TSX. | codex |
| 2026-02-08 | activities/java-format-practice | Converting parser-heavy client utilities to TS under `noUncheckedIndexedAccess` requires explicit index guards/nullish defaults around string/token access, even when loop bounds already look safe in JS. | Prevents subtle strict-type regressions while preserving existing formatter/evaluator behavior and existing JS test coverage. | `activities/java-format-practice/client/utils/safeEvaluator.ts`, `activities/java-format-practice/client/utils/formatUtils.ts`, `activities/java-format-practice/client/utils/stringUtils.ts`, `activities/java-format-practice/client/utils/validationUtils.ts`, `npm --workspace activities run typecheck`, `npm --workspace activities test`. | Continue Java Format Practice by migrating manager/student/components and core challenge generator to TS/TSX. | codex |
| 2026-02-08 | activities/tooling | In the activities workspace test runtime (`node --import tsx --import ../scripts/jsx-loader-register.mjs`), some converted TSX files still require explicit `React` in scope at runtime even with TSX source. | Prevents confusing “React is not defined” failures during incremental component migration; impacts how TSX files are authored before final tooling cleanup. | `activities/java-format-practice/client/components/ChallengeQuestion.tsx`, `activities/java-format-practice/client/components/ChallengeSelector.tsx`, `activities/java-format-practice/client/components/StatsPanel.tsx`, `activities/java-format-practice/client/components/ReferenceModal.tsx`, `activities/java-format-practice/client/components/basicComponents.test.tsx`. | Revisit activities test JSX runtime configuration in later cleanup to remove the explicit React-scope requirement. | codex |
| 2026-02-08 | activities/java-format-practice | Completing the Java Format Practice client migration required explicit `useState` generics plus typed `Record<number, ...>` row maps in `JavaFormatPractice.tsx`; otherwise strict TS inferred `never` across challenge/feedback/output state and cascaded errors through manager/student render paths. | Provides a repeatable pattern for finishing large state-heavy activity components under strict mode without runtime behavior changes. | `activities/java-format-practice/client/student/JavaFormatPractice.tsx`, `activities/java-format-practice/javaFormatPracticeTypes.ts`, `npm --workspace activities run typecheck`, `npm test`. | Reuse this pattern for remaining state-heavy activity migrations before Phase 7 strictness cleanup. | codex |
| 2026-02-08 | activities/traveling-salesman | A safe kickoff slice for large remaining activities can migrate only `activity.config` + `client/index` to TS and add a client-module shape test before converting manager/student/routes internals. | Keeps one-activity slices reviewable while validating loader/registry contracts early and preserving runtime behavior. | `activities/traveling-salesman/activity.config.ts`, `activities/traveling-salesman/client/index.ts`, `activities/traveling-salesman/client/index.test.ts`, `npm --workspace activities test`, `npm run typecheck --workspaces --if-present`. | Continue Traveling Salesman by migrating server routes and shared client/server utilities in the next slice, then manager/student components. | codex |
| 2026-02-08 | activities/traveling-salesman | Migrating a route-heavy activity server is more stable when session normalization + narrowing helpers are centralized in one activity-local types module and reused by each route file. | Keeps strict TS manageable across many route handlers, avoids repeated ad-hoc casts, and preserves behavior while converting `routes/*` incrementally. | `activities/traveling-salesman/travelingSalesmanTypes.ts`, `activities/traveling-salesman/server/routes/*.ts`, `activities/traveling-salesman/server/routes.test.ts`, `npm --workspace activities run typecheck`, `npm --workspace activities test`. | Continue traveling-salesman with client-side utility/hooks/components migration using the same shared-contract-first pattern. | codex |
| 2026-02-08 | activities/traveling-salesman | Converting dense utility layers to TS in this repo is smoother when a local utility-types module is introduced first and defaults for array/object parameters are explicitly typed (otherwise strict mode infers `never[]` and cascades errors). | Keeps utility conversion slices small and predictable under strict settings (`noUncheckedIndexedAccess`, `noImplicitAny`) while preserving runtime behavior. | `activities/traveling-salesman/client/utils/tspUtilsTypes.ts`, `activities/traveling-salesman/client/utils/leaderboardBuilders.ts`, `activities/traveling-salesman/client/utils/routeLegend.ts`, `npm --workspace activities run typecheck`, `npm --workspace activities test`. | Reuse this pattern for remaining traveling-salesman client hooks/components and for `gallery-walk` / `python-list-practice` utility migrations. | codex |
| 2026-02-08 | activities/traveling-salesman | Finishing TSX migration for state-heavy activity shells is more reliable when websocket payload/session shapes are typed once (`TspSessionData`/`TspSessionMessage`) and component-local state uses explicit generic types (`SoloAlgorithmsState`, `SoloProgressState`) instead of inferred literals. | Prevents strict-mode `never` cascades across `useState` updates and keeps manager/student shell migrations incremental without behavior changes. | `activities/traveling-salesman/client/manager/TSPManager.tsx`, `activities/traveling-salesman/client/student/TSPStudent.tsx`, `activities/traveling-salesman/client/utils/tspUtilsTypes.ts`, `npm --workspace activities run typecheck`, `npm --workspace activities test`. | Reuse this typed-shape-first approach for remaining large activity shells (`gallery-walk`, `python-list-practice`) during Phase 5 completion. | codex |
| 2026-02-08 | activities/traveling-salesman | Shared map render helper contracts must align nullability with component props (`terrainSeed?: number` instead of `number | null`) when moving JSX modules to TSX. | Avoids repeated prop incompatibility errors between utility builders and component interfaces during strict TS conversion. | `activities/traveling-salesman/client/utils/mapRenderConfig.ts`, `activities/traveling-salesman/client/components/CityMap.tsx`, `npm --workspace activities run typecheck`. | Keep helper-return interfaces synchronized with consuming component prop types as remaining activities convert to TSX. | codex |
| 2026-02-08 | activities/gallery-walk | A low-risk kickoff for larger remaining activity directories is to convert `activity.config` and `client/index` to TS first and add a client-module shape test before touching route/component internals. | Keeps one-activity migration slices small and reviewable while validating loader/registry contracts early with minimal behavior risk. | `activities/gallery-walk/activity.config.ts`, `activities/gallery-walk/client/index.ts`, `activities/gallery-walk/client/index.test.ts`, `npm --workspace activities test`, `npm run typecheck --workspaces --if-present`. | Continue gallery-walk by migrating shared `shared/*.js` helpers and `server/routes.js` next, then client hooks/components. | codex |
| 2026-02-08 | activities/gallery-walk | Converting `gallery-walk` shared helpers and `server/routes` to TS is stable when client imports are switched to extensionless paths and server route tests use ws stubs typed to the shared websocket contracts. | Prevents mixed-extension resolution breaks (`.js` imports to deleted shared files) and catches ws handler contract drift during strict migration. | `activities/gallery-walk/shared/id.ts`, `activities/gallery-walk/shared/noteStyles.ts`, `activities/gallery-walk/server/routes.ts`, `activities/gallery-walk/activity.config.ts`, `server/galleryWalkRoutes.test.ts`, `npm --workspace activities test`, `npm --workspace server test`, `npm test`. | Continue gallery-walk by migrating client hooks/components to TS/TSX, reusing typed message/session helpers to keep state-heavy conversions incremental. | codex |
| 2026-02-08 | activities/gallery-walk | Session-hook migration for websocket-heavy activity clients is lower risk when parse/merge logic is extracted into pure typed helpers (`build...WsUrl`, message parsing, feedback merge) and tested directly. | Keeps strict TS changes in hook state management auditable without requiring full React hook test harnesses, while preserving runtime behavior in JSX manager/student shells. | `activities/gallery-walk/client/hooks/useGalleryWalkSession.ts`, `activities/gallery-walk/client/hooks/useGalleryWalkSession.test.ts`, `activities/gallery-walk/client/manager/feedbackUtils.ts`, `activities/gallery-walk/client/manager/managerUtils.ts`, `npm --workspace activities run typecheck`, `npm --workspace activities test`. | Next gallery-walk slice should migrate remaining manager/student/components from JS/JSX to TS/TSX using the same typed-helper-first approach. | codex |
| 2026-02-08 | activities/gallery-walk | Converting a cluster of shared activity components to TSX can be done safely before manager/student shell conversion by switching remaining JSX importers to extensionless specifiers and adding a module-shape test that imports each converted component. | Keeps migration slices reviewable while still catching broken exports/resolution issues introduced by bulk component extension changes. | `activities/gallery-walk/client/components/*.tsx`, `activities/gallery-walk/client/components/galleryWalkComponents.test.ts`, `activities/gallery-walk/client/student/StudentPage.jsx`, `activities/gallery-walk/client/manager/ManagerPage.jsx`, `npm --workspace activities run typecheck`, `npm --workspace activities test`. | Next gallery-walk slice should migrate the remaining large JSX shells (`GalleryWalkSoloViewer`, `GalleryWalkNotesView`, `ManagerPage`, `StudentPage`) and retire the last `.jsx` files in this activity. | codex |
| 2026-02-08 | activities/gallery-walk | Final TSX conversion of the largest activity shells is safer when websocket payload narrowing is centralized in typed hook helpers and component prop nullability is aligned to real runtime payloads (`projectTitle` nullable, feedback `id` optional). | Prevents strict-mode breakage from catch-variable unknowns and mismatched optional/null fields while preserving existing gallery-walk behavior during full-shell migration. | `activities/gallery-walk/client/student/StudentPage.tsx`, `activities/gallery-walk/client/manager/ManagerPage.tsx`, `activities/gallery-walk/client/components/GalleryWalkSoloViewer.tsx`, `activities/gallery-walk/client/components/GalleryWalkNotesView.tsx`, `npm --workspace activities run typecheck`, `npm --workspace activities test`, `npm run typecheck --workspaces --if-present`. | Final gallery-walk cleanup slice: convert `activities/gallery-walk/client/manager/ManagerPage.test.js` to `.test.ts` so the activity tree is fully TS/TSX. | codex |
| 2026-02-08 | activities/gallery-walk | Final JS test conversion in a migrated activity often only needs strict-null-safe assertion tweaks (`result[0]?.message`) after renaming to `.test.ts`; runtime assertions stay identical. | Helps finish activity-level JS->TS cleanup without reopening behavioral scope late in migration. | `activities/gallery-walk/client/manager/ManagerPage.test.ts`, `npm --workspace activities run typecheck`, `npm --workspace activities test`. | Carry this “convert last JS tests with minimal null-safe assertion fixes” pattern into remaining activities that are source-complete but still have `.test.js` files. | codex |
| 2026-02-09 | activities/tooling | During mixed TS migration in `activities`, keeping `@typescript-eslint/strict-boolean-expressions` enabled as an error blocked lint with broad legacy truthiness patterns; moving it to a temporary off-state while preserving `no-floating-promises` as error unblocks CI without weakening async-safety checks. | Allows `activities` lint/test to pass while strict-boolean cleanup proceeds incrementally across many modules. | `activities/eslint.config.js`, `npm --workspace activities run lint` (0 errors), `npm --workspace activities test` (54 pass), `npm --workspace activities run typecheck`. | Re-enable `strict-boolean-expressions` after activity-by-activity truthiness normalization is complete. | codex |
| 2026-02-09 | activities/tooling | `@typescript-eslint/strict-boolean-expressions` has now been re-enabled in `activities`, with legacy truthiness checks converted to explicit null/length comparisons and type-safe guards across activity client/server files. Local VS Code ESLint stability improved by setting `eslint.run` to `onSave` and raising ESLint extension Node heap (`eslint.execArgv --max-old-space-size=4096`). | Keeps strict lint quality restored while reducing extension restarts during large type-aware lint passes in the monorepo. | `activities/eslint.config.js`, `.vscode/settings.json`, `npm --workspace activities run lint`, `npm --workspace activities run typecheck`, `npm --workspace activities test`. | Keep strict boolean rule enabled and continue using on-save linting in editor for large migration branches. | codex |
| 2026-02-09 | tooling | `server/.eslintcache` was tracked in git and became malformed (`[]`), which caused `eslint` to crash in `file-entry-cache` (`TypeError: Cannot convert undefined or null to object`) before linting. | Tracking mutable cache artifacts can destabilize local lint workflows and VS Code ESLint behavior across contributors. | `server/.eslintcache` (2-byte `[]`), `npm --workspace server run lint` failing stack trace from `flat-cache/src/cache.js`, follow-up pass after removing cache usage in `server/package.json`. | Keep ESLint cache files ignored/untracked and avoid hard dependency on cache files in lint scripts. | codex |
| 2026-02-09 | activities/tooling | Added scoped lint scripts in `activities` so lint can target a single folder/path (`lint:activity`, `lint:scope`) instead of always scanning the entire workspace. | Reduces memory/CPU pressure during migration branches and avoids repeated editor/agent crashes on full type-aware activity lint runs. | `activities/package.json`, `npm --workspace activities run lint:activity --activity=traveling-salesman`, `npm --workspace activities run lint:scope --target=java-format-practice`. | Use scoped scripts during active migration; keep full `npm --workspace activities run lint` for final pre-merge verification. | codex |
| 2026-02-09 | activities/tooling | Added scoped activity test scripts (`test:activity`, `test:scope`) that run lint + tests for only the requested subpath, and normalized target inputs so both `activities/<id>/...` and workspace-relative paths work. | Provides stable, low-memory verification loops during migration and avoids full-suite extension crashes while keeping lint coupled to each scoped test run. | `activities/package.json`, `package.json`, `npm run test:activities:activity -- --activity=traveling-salesman`, `npm run test:activities:scope -- --target=activities/traveling-salesman/client/hooks`. | Use scoped test scripts for iterative fixes; keep `npm test` as final merge gate. | codex |
| 2026-02-09 | tooling | Long monorepo checks can be made crash-resistant in this environment by wrapping commands with a heartbeat script that prints periodic progress lines while preserving the original command exit code. | Prevents idle-output timeouts from killing long runs and gives a repeatable way to run root checks without extension disconnects. | `scripts/with-heartbeat.sh`, `package.json` scripts `typecheck:hb`, `test:chunks:hb`, `test:hb`, `npm run -s typecheck:hb`, `npm run -s test:activities:scope:hb -- --target=activities/traveling-salesman/client/hooks`. | Use `*:hb` scripts for long validations in Codex; keep normal scripts for local developer runs. | codex |
